PUSHR RAX
PUSH 2
ADD
POPR RAX

PUSH 0
PUSHR RAX
PUSH -2
ADD
POPR RCX
POPM [RCX]

IN

PUSHR RAX
PUSH -2
ADD
POPR RCX
POPM [RCX]

PUSHR RAX
PUSH -2
ADD
POPR RCX
PUSHM [RCX]

CALL :countfact

PUSHR RAX
PUSH -1
ADD
POPR RCX
POPM [RCX]

PUSHR RAX
PUSH -1
ADD
POPR RCX
PUSHM [RCX]

OUT

PUSHR RAX
PUSH 2
SUB
POPR RAX

HLT


:countfact
PUSHR RAX
PUSH 1
ADD
POPR RAX

PUSHR RAX
PUSH -1
ADD
POPR RCX
POPM [RCX]

PUSHR RAX
PUSH -1
ADD
POPR RCX
PUSHM [RCX]

PUSH 1
SUB

PUSH 0
JA :else_0
PUSH 1
PUSHR RAX
PUSH 1
SUB
POPR RAX
RET

JMP :end_if_0
:else_0
PUSHR RAX
PUSH -1
ADD
POPR RCX
PUSHM [RCX]

PUSHR RAX
PUSH -1
ADD
POPR RCX
PUSHM [RCX]

PUSH 1
SUB

CALL :countfact

MUL

PUSHR RAX
PUSH 1
SUB
POPR RAX
RET

:end_if_0
PUSHR RAX
PUSH 1
SUB
POPR RAX

RET

